{extend name="admin@public/base_content" /}
{block name="body">}
<body>
{include file="admin@public/common" /}
<!--头部搜索开始-->
<div class="container-fluid larry-wrapper">
    <div class="row">
        <div class="col-xs-12 col-sm-12 col-md-12">
            <section class="panel panel-padding">
                <form class="layui-form" action="{:url('')}">
                    <div class="layui-form">
                        <div class="layui-inline">
                            <div class="layui-input-inline">
                                <input class="layui-input" name="assetname" value="{$pageMaps.assetname|default=''}" placeholder="请输入资产名称">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <div class="layui-input-inline">
                                <input class="layui-input" name="username" value="{$pageMaps.username|default=''}" placeholder="请输入项目经理姓名">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <div class="layui-input-inline">
                                <input class="layui-input" name="mobile" value="{$pageMaps.mobile|default=''}" placeholder="请输入项目经理联系电话">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <div class="layui-input-inline" style="width: 150px">
                                <select name="asset_leavedishi" id="asset_leavedishi"  lay-filter="productselect">
                                    <option value="">请选择存放地区</option>
                                    {foreach assettype as $key=>$value}
                                    {if condition="$value.lever eq 1"}
                                    <option value="{$value.id}" {if condition="$pageMaps.asset_leavedishi eq $value.id"}selected{/if}>{$value.parentname}</option>
                                        {foreach $value['chilrenname'] as $k=>$val}
                                            <option value="{$val.id}" {if condition="$pageMaps.asset_leavedishi eq $val.id"}selected{/if}> &nbsp;&nbsp;&nbsp;&nbsp; -- {$val.assettype}</option>
                                        {/foreach}
                                        {/if}
                                    {/foreach}
                                </select>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <div class="layui-input-inline" style="width: 150px">
                                <select name="producttype" id="producttype"  lay-filter="productselect">
                                    <option value="">请选择押品分类</option>
                                    {foreach assettype as $key=>$value}
                                    {if condition="$value.lever eq 2"}
                                    <option value="{$value.id}" {if condition="$pageMaps.producttype eq $value.id"}selected{/if}>{$value.parentname}</option>
                                        {foreach $value['chilrenname'] as $k=>$val}
                                            <option value="{$val.id}" {if condition="$pageMaps.producttype eq $val.id"}selected{/if}> &nbsp;&nbsp;&nbsp;&nbsp; -- {$val.assettype}</option>
                                        {/foreach}
                                        {/if}
                                    {/foreach}
                                </select>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <div class="layui-input-inline" style="width: 150px">
                                <select name="scape" id="scape"  lay-filter="productselect">
                                    <option value="">请选择规模</option>
                                    {foreach assettype as $key=>$value}
                                    {if condition="$value.lever eq 3"}
                                    <option value="{$value.id}" {if condition="$pageMaps.scape eq $value.id"}selected{/if}>{$value.parentname}</option>
                                        {foreach $value['chilrenname'] as $k=>$val}
                                            <option value="{$val.id}" {if condition="$pageMaps.scape eq $val.id"}selected{/if}> &nbsp;&nbsp;&nbsp;&nbsp; -- {$val.assettype}</option>
                                        {/foreach}
                                        {/if}
                                    {/foreach}
                                </select>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <div class="layui-input-inline" style="width: 150px">
                                <select name="trade" id="trade"  lay-filter="productselect">
                                    <option value="">请选择行业</option>
                                    {foreach assettype as $key=>$value}
                                    {if condition="$value.lever eq 4"}
                                    <option value="{$value.id}" {if condition="$pageMaps.trade eq $value.id"}selected{/if}>{$value.parentname}</option>
                                        {foreach $value['chilrenname'] as $k=>$val}
                                            <option value="{$val.id}"  {if condition="$pageMaps.trade eq $val.id"}selected{/if}> &nbsp;&nbsp;&nbsp;&nbsp; -- {$val.assettype}</option>
                                        {/foreach}
                                        {/if}
                                    {/foreach}
                                </select>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <div class="layui-input-inline" style="width: 150px">
                                <select name="status" id="status" >
                                    <option value="" {if condition="$pageMaps.status eq ''"}selected{/if}>是否审核</option>
                                    <option value="1" {if condition="$pageMaps.status eq '1'"}selected{/if}>已审核</option>
                                    <option value="0"  {if condition="$pageMaps.status eq '0'"}selected{/if}>未审核</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <button lay-submit class="layui-btn" lay-filter="search">查找</button>
                        </div>
                    </div>
                </form>
            </section>
        </div>
    </div>
</div>
<!--头部搜索结束-->
<div class="layui-form">
    <table class="layui-table lay-even">
        <thead>
        <tr>
            <th>序号</th>
            <th>资产名称</th>
           <!--  <th>资产分类</th> -->
            <th>行业</th>
            <th>地区</th>
            <th>本金</th>
            <th>利息</th>
            <th>担保方式</th>
            <th>保证人</th>
           <!--  <th>抵押品类型</th> -->
            <th>押品类型</th>
            <th>押品数量</th>
            <th>存放地区</th>
            <th>项目经理姓名</th>
            <th>项目经理手机号</th>
            <th>客户收藏数</th>
			<th>客户浏览数</th>
            <th>留言数</th>
            <th>是否审核</th>
            <th>是否为精品推荐</th>
            <th>是否为下架</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        {foreach name="list" item="vo" key="k"}
        <tr>
            <td align="center"><input type="checkbox" name="act" value="{$vo.id}" lay-skin="primary" lay-filter="c_one" class="act" style="width: 30px;height: 30px"></td>
            <td>{$vo.asset_name}</td>
       <!--      <td>{$vo.asset_class}</td> -->
            <td>{$vo.asset_trade}</td>
            <td>{$vo.asset_quxian}</td>
            <td>{$vo.asset_basemoney}</td>
            <td>{$vo.asset_getmoney}</td>
            <td>{$vo.asset_danbaomethod}</td>
            <td>{$vo.asset_danbaoperson}</td>
            <td>{$vo.asset_childclass}</td>
            <td>{$vo.asset_diyanumber}</td>
            <td>{$vo.asset_leavediquxian}</td>
            <td>{$vo.asset_manager}</td>
            <td>{$vo.asset_managerline}</td>
            <td><a href="{:url('collectinfo',array('asset_name'=>$vo.asset_name))}" class="layui-btn layui-btn-mini modal-catch">{$vo.collectNum}</a></td>
			<td><a href="{:url('viewinfo',array('asset_name'=>$vo.asset_name))}" class="layui-btn layui-btn-mini modal-catch">{$vo.viewtNum}</a></td>
            <td>{$vo.discussNum}</td>
            <td>{if condition="$vo.status neq 0"}已审核{else/}未审核{/if}</td>
            <td>{if condition="$vo.competitive neq 0"}精品{else/}非精品{/if}</td>
            <td>{if condition="$vo.isshelves neq 0"}下架{else/}上架{/if}</td>
            <td>
                <a href="{:url('info',array('id'=>$vo.id))}" class="layui-btn layui-btn-mini modal-catch">
                    <i class="iconfont">&#xe653;</i>编辑
                </a><br/>
                <a class="layui-btn layui-btn-mini layui-btn-danger ajax"
                   data-list='{"key":"id={$vo.id}","msg":true,"render":"true","action":"del"}'
                   data-params='{"url": "{:url("del")}","confirm":"true","data":"id={$vo.id}","complete":"del"}' style="margin-top: 5px">
                    <i class="iconfont">&#xe626;</i>删除
                </a><br/>
                <a class="layui-btn layui-btn-mini layui-btn-danger ajax"
                   data-list='{"key":"id={$vo.id}","msg":true,"render":"true","action":"verify"}'
                   data-params='{"url": "{:url("verify")}","confirm":"true","data":"id={$vo.id}","complete":"verify"}' style="margin-top: 5px">
                    <i class="iconfont">&#xe626;</i>审核
                </a>
                {if condition="$vo.isshelves eq 0"}
                 <a class="layui-btn layui-btn-mini layui-btn-danger ajax"
                   data-list='{"key":"id={$vo.id}","msg":true,"render":"true","action":"saleon"}'
                   data-params='{"url": "{:url("saleOn")}","confirm":"true","data":"id={$vo.id}","complete":"saleon"}' style="margin-top: 5px;margin-left: 0px">
                    <i class="iconfont">&#xe626;</i>下架
                </a>{/if}
                {if condition="$vo.isshelves eq 1"}
                 <a class="layui-btn layui-btn-mini layui-btn-danger ajax"
                   data-list='{"key":"id={$vo.id}","msg":true,"render":"true","action":"saleout"}'
                   data-params='{"url": "{:url("saleOut")}","confirm":"true","data":"id={$vo.id}","complete":"saleout"}' style="margin-top: 5px;margin-left: 0px">
                    <i class="iconfont">&#xe626;</i>上架
                </a>{/if}
            </td>
        </tr>
        {/foreach}
        </tbody>
    </table>
<input type="checkbox" lay-skin="primary"  id="c_all" lay-filter="c_all" title="全部">
<input type="checkbox" lay-skin="primary"  id="f_all" lay-filter="f_all" title="反选">
<a href="#" onclick="allverify()">全部审核</a>
<a href="#" onclick="allsaleon()">全部上架</a>
<a href="#" onclick="allsaleout()">全部下架</a>
</div>

<div class="text-right" style="text-align: center;">
    <div class="layui-box layui-laypage layui-laypage-molv" id="layui-laypage-1">
        {$list|raw}
    </div>
</div>

</body>
{/block}
{block name="script"}
<script>
    layui.use('default');
layui.use([ 'layer', 'jquery', 'form'], function () {
    var form = layui.form();
    var $ = layui.jquery;
    form.on('checkbox(c_all)', function (data) {
        var a = data.elem.checked;
        if (a == true) {
            $(".act").prop("checked", true);
            form.render('checkbox');
        } else {
            $(".act").prop("checked", false);
            form.render('checkbox');
        }

    });

    form.on('checkbox(f_all)', function (data) {
        var item = $(".act");
        item.each(function () {
            if ($(this).prop("checked")) {
                $(this).prop("checked", false);
            } else {
                $(this).prop("checked", true);
            }
        })
        form.render('checkbox');
    });
})

function allverify(){
    var arr = new Array();
    var $ = layui.jquery;
    $i = 0;
    $(".layui-form-checkbox").each(function(index,vo){
        if ($(this).hasClass('layui-form-checked')) {
            arr[$i] = $(this).prev().val();
            $i++;
        }
    })
    var str = arr.join(",");
    if (str == "") {
        layer.msg('请先选中要审核的资产', {time: 1000, icon: 1}, function () {
            
        });
        return false;
    }
    $.post("{:url('allverify')}", {data:str}, function (res) {
        console.log(res)
        if (res.status == 200) {
            layer.msg(res.msg, {time: 1800, icon: 1}, function () {
                location.href = res.url;
            });
        } else {
            layer.msg(res.msg, {time: 1800, icon: 2});
        }
    }, 'json');
    return false;
}

function allsaleon(){
    var arr = new Array();
    var $ = layui.jquery;
    $i = 0;
    $(".layui-form-checkbox").each(function(index,vo){
        if ($(this).hasClass('layui-form-checked')) {
            arr[$i] = $(this).prev().val();
            $i++;
        }
    })
    var str = arr.join(",");
    if (str == "") {
        layer.msg('请先选中要上架的资产', {time: 1000, icon: 1}, function () {
            
        });
        return false;
    }
    $.post("{:url('allsaleon')}", {data:str}, function (res) {
        if (res.status == 200) {
            layer.msg(res.msg, {time: 1800, icon: 1}, function () {
                location.href = res.url;
            });
        } else {
            layer.msg(res.msg, {time: 1800, icon: 2});
        }
    }, 'json');
    return false;
}

function allsaleout(){
    var arr = new Array();
    var $ = layui.jquery;
    $i = 0;
    $(".layui-form-checkbox").each(function(index,vo){
        if ($(this).hasClass('layui-form-checked')) {
            arr[$i] = $(this).prev().val();
            $i++;
        }
    })
    var str = arr.join(",");
    if (str == "") {
        layer.msg('请先选中要下架的资产', {time: 1000, icon: 1}, function () {
            
        });
        return false;
    }
    $.post("{:url('allsaleout')}", {data:str}, function (res) {
        console.log(res)
        if (res.status == 200) {
            layer.msg(res.msg, {time: 1800, icon: 1}, function () {
                location.href = res.url;
            });
        } else {
            layer.msg(res.msg, {time: 1800, icon: 2});
        }
    }, 'json');
    return false;
}
    
</script>
{/block}